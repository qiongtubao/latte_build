#!/usr/bin/env node
var Path = require('path');
var latte_lib = require('latte_lib');
var getConfig = function() {
	var config;
	var index = process.argv.indexOf("-c");
	if(index != -1) {
		config = process.argv[index+1];
	}
	config = config || "./.latte/make.json";
	var buildConfigPath = Path.join(process.cwd()+"/"+config);
	var buildConfig;
	try {
		buildConfig = require(buildConfigPath);
	}catch(e) {
		if(e.code == 'MODULE_NOT_FOUND') {
			console.error("找不到配置文件路径错误",buildConfigPath);
		}
		return null;
	}
	return buildConfig;
}
var make = require('../lib');
module.exports = function(command) {
	var config = getConfig();
	if(config == null) {
		return ;
	}
	config = latte_lib.format.templateJsonFormat(config, config.opts || {});
	var startTime = Date.now();
	make.make(config, command || "main", function(err) {
		if(err) {
			return console.log('make failed:', err.message? err.message: err);
		}
		console.log('make sucess:', Date.now() - startTime , "ms");
	});
}
